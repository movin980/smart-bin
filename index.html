<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Campus Lost & Found</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #2b8aef;
      --bg: #f9fafc;
      --card: #fff;
      --muted: #6b7280;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg); color: #111;
    }
    header {
      background: var(--accent); color: #fff;
      padding: 16px 24px; font-size: 18px; font-weight: 600;
      box-shadow: var(--shadow);
    }
    .container {
      max-width: 960px; margin: 24px auto; padding: 0 16px;
      display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
    }
    .card {
      background: var(--card); border-radius: 12px; padding: 16px;
      box-shadow: var(--shadow);
    }
    h3 { margin-top: 0; font-size: 18px; }
    label { font-size: 13px; font-weight: 600; margin-top: 10px; display: block; }
    input, textarea, select {
      width: 100%; padding: 8px; margin-top: 6px;
      border: 1px solid #ddd; border-radius: 8px; font-size: 14px;
    }
    button {
      padding: 8px 14px; border: none; border-radius: 8px;
      background: var(--accent); color: #fff; font-weight: 600;
      cursor: pointer; margin-top: 12px;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .item-grid {
      display: grid; gap: 14px;
    }
    .item-card {
      display: flex; gap: 12px; padding: 12px;
      border-radius: 10px; background: #fff; box-shadow: var(--shadow);
      align-items: flex-start;
    }
    .thumb {
      width: 70px; height: 70px; border-radius: 8px;
      object-fit: cover; background: #eee;
    }
    .meta { flex: 1; }
    .meta h4 { margin: 0 0 4px; font-size: 15px; }
    .badge {
      display: inline-block; padding: 3px 8px;
      border-radius: 999px; font-size: 12px; font-weight: 600;
      color: #fff; margin-top: 6px;
    }
    .badge.lost { background: #e74c3c; }
    .badge.found { background: #27ae60; }
    .small-muted { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .empty { text-align: center; color: var(--muted); padding: 20px; }
  </style>
</head>
<body>
  <header>Campus Lost & Found</header>

  <div class="container">
    <!-- Report Form -->
    <div class="card">
      <h3>Report Item</h3>
      <form id="reportForm">
        <label>Type</label>
        <select id="type" required>
          <option value="lost">Lost</option>
          <option value="found">Found</option>
        </select>

        <label>Item Name</label>
        <input id="itemName" type="text" required placeholder="e.g., Black wallet" />

        <label>Description</label>
        <textarea id="description" placeholder="Details about the item..."></textarea>

        <label>Contact</label>
        <input id="contact" type="text" required placeholder="email or phone" />

        <label>Photo (optional)</label>
        <input id="photo" type="file" accept="image/*" />

        <button type="submit" id="submitBtn">Submit</button>
        <div id="formMsg" class="small-muted"></div>
      </form>
    </div>

    <!-- Items List -->
    <div class="card">
      <h3>Reported Items</h3>
      <div id="itemsContainer" class="item-grid"></div>
      <div id="itemsEmpty" class="empty">No items reported yet.</div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyAXak-lN_WmRe0CbN0UkwcwxTfayIE5FA0",
      authDomain: "smartbin34.firebaseapp.com",
      databaseURL: "https://smartbin34-default-rtdb.firebaseio.com",
      projectId: "smartbin34",
      storageBucket: "smartbin34.appspot.com",
      messagingSenderId: "1098169082361",
      appId: "1:1098169082361:web:87ce799868d755b4f11d28",
      measurementId: "G-VEJY91T6CM"
    };

    firebase.initializeApp(FIREBASE_CONFIG);
    const db = firebase.database();
    const storage = firebase.storage();

    const form = document.getElementById("reportForm");
    const msg = document.getElementById("formMsg");
    const submitBtn = document.getElementById("submitBtn");
    const itemsContainer = document.getElementById("itemsContainer");
    const itemsEmpty = document.getElementById("itemsEmpty");

    // Compress image before upload
    function compressImage(file, maxWidth, maxHeight, callback) {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = (e) => {
        const img = new Image();
        img.src = e.target.result;
        img.onload = () => {
          const canvas = document.createElement("canvas");
          let { width, height } = img;
          if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; }
          if (height > maxHeight) { width *= maxHeight / height; height = maxHeight; }
          canvas.width = width; canvas.height = height;
          canvas.getContext("2d").drawImage(img, 0, 0, width, height);
          canvas.toBlob(blob => callback(blob), "image/jpeg", 0.7);
        };
      };
    }

    // Render one item
    function renderItem(item) {
      const card = document.createElement("div");
      card.className = "item-card";
      card.innerHTML = `
        <img class="thumb" src="${item.imageUrl || "https://via.placeholder.com/70"}" alt="${item.name}">
        <div class="meta">
          <h4>${item.name}</h4>
          <div class="small-muted">${item.description || ""}</div>
          <div class="small-muted">Contact: ${item.contact}</div>
          <span class="badge ${item.type}">${item.type.toUpperCase()}</span>
        </div>
      `;
      return card;
    }

    // Subscribe to DB
    db.ref("items").on("value", snap => {
      itemsContainer.innerHTML = "";
      if (!snap.exists()) {
        itemsEmpty.style.display = "block"; return;
      }
      itemsEmpty.style.display = "none";
      Object.values(snap.val()).reverse().forEach(item => {
        itemsContainer.appendChild(renderItem(item));
      });
    });

    // Handle form submit
    form.onsubmit = e => {
      e.preventDefault();
      submitBtn.disabled = true;
      msg.textContent = "Submitting...";

      const type = document.getElementById("type").value;
      const name = document.getElementById("itemName").value.trim();
      const description = document.getElementById("description").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const file = document.getElementById("photo").files[0];

      if (!name || !contact) {
        msg.textContent = "Item name and contact required.";
        submitBtn.disabled = false; return;
      }

      const saveItem = (imageUrl) => {
        const ref = db.ref("items").push();
        const data = { type, name, description, contact, imageUrl, createdAt: Date.now() };
        ref.set(data).then(() => {
          msg.textContent = "Report submitted âœ…";
          form.reset();
          submitBtn.disabled = false;
          setTimeout(() => msg.textContent = "", 2000);
        });
      };

      if (file) {
        compressImage(file, 800, 800, (blob) => {
          const path = "images/" + Date.now() + "_" + file.name.replace(/\s+/g, "_");
          const uploadTask = storage.ref(path).put(blob);
          uploadTask.on("state_changed",
            snap => msg.textContent = `Uploading... ${Math.round((snap.bytesTransferred / snap.totalBytes) * 100)}%`,
            err => { console.error(err); msg.textContent = "Upload failed."; submitBtn.disabled = false; },
            () => uploadTask.snapshot.ref.getDownloadURL().then(url => saveItem(url))
          );
        });
      } else {
        saveItem(null);
      }
    };
  </script>
</body>
</html>
